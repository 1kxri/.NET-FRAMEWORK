using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;

namespace LAB_8.NET
{
    internal class Program
    {
        static Random randomGenerator = new Random();

        static void Main(string[] args)
        {
            int mainChoice;
        startMenu:
            try
            {
                do
                {
                    Console.WriteLine("\nВыберите задание 1-4 или 0 для выхода:");
                    Console.WriteLine("1 - Работа с файлом целых чисел");
                    Console.WriteLine("2 - Создание папки");
                    Console.WriteLine("3 - Создание текстового файла разными методами");
                    Console.WriteLine("4 - Чтение из файла");
                    Console.WriteLine("0 - Выход");
                    Console.Write("Выберите действие: ");

                    mainChoice = Convert.ToInt32(Console.ReadLine());

                    switch (mainChoice)
                    {
                        case 1:
                            {
                                string projectRootPath = Directory.GetParent(Directory.GetCurrentDirectory()).Parent.Parent.FullName;
                                string projectFolder = Path.Combine(projectRootPath, "LAB_8.NET");
                                string numbersFilePath = Path.Combine(projectFolder, "numbers.txt");
                                Console.WriteLine($"Файл будет создан: {numbersFilePath}");

                                Console.WriteLine("Выберите режим заполнения:");
                                Console.WriteLine("1 - Ввести числа вручную");
                                Console.WriteLine("2 - Заполнить случайными числами (от -99 до 99)");

                                string fillMode;
                                bool validFillMode = false;
                                do
                                {
                                    Console.Write("Ваш выбор: ");
                                    fillMode = Console.ReadLine();
                                    if (fillMode == "1" || fillMode == "2")
                                        validFillMode = true;
                                    else
                                        Console.WriteLine("Несуществующий выбор, попробуйте снова");
                                } while (!validFillMode);

                                int[] numberArray;

                                if (fillMode == "1")
                                {
                                    string userInput;
                                    var numberList = new List<int>();

                                    do
                                    {
                                        Console.WriteLine("Введите целые числа через пробел:");
                                        userInput = Console.ReadLine();

                                        string[] inputParts = userInput.Split(new char[] { ' ', '\t', ',', ';' }, StringSplitOptions.RemoveEmptyEntries);
                                        numberList.Clear();

                                        foreach (string part in inputParts)
                                        {
                                            if (int.TryParse(part, out int parsedNumber))
                                                numberList.Add(parsedNumber);
                                        }

                                        if (numberList.Count == 0)
                                        {
                                            Console.WriteLine("Не было введено ни одного целого числа, попробуйте снова\n");
                                        }

                                    } while (numberList.Count == 0);

                                    numberArray = numberList.ToArray();
                                }
                                else
                                {
                                    int numbersCount;
                                    do
                                    {
                                        Console.Write("Введите количество случайных чисел: ");
                                    } while (!int.TryParse(Console.ReadLine(), out numbersCount) || numbersCount <= 0);

                                    numberArray = new int[numbersCount];
                                    for (int i = 0; i < numbersCount; i++)
                                        numberArray[i] = randomGenerator.Next(-99, 100);
                                }

                                File.WriteAllText(numbersFilePath, string.Join(" ", numberArray));
                                Console.WriteLine("\nФайл создан и числа записаны в него.");

                                string fileContent = File.ReadAllText(numbersFilePath);
                                Console.WriteLine("\nСодержимое файла:");
                                Console.WriteLine(fileContent);

                                string[] fileElements = fileContent.Split(new char[] { ' ', '\n', '\r', '\t' }, StringSplitOptions.RemoveEmptyEntries);
                                int evenNumbersCount = 0;

                                foreach (string element in fileElements)
                                {
                                    if (int.TryParse(element, out int numberValue))
                                    {
                                        if (numberValue % 2 == 0)
                                            evenNumbersCount++;
                                    }
                                }

                                Console.WriteLine($"\nКоличество четных чисел: {evenNumbersCount}");
                            }
                            break;

                        case 2:
                            {
                                Console.WriteLine("Выберите режим создания папки:");
                                Console.WriteLine("1 - По имени (в текущем проекте)");
                                Console.WriteLine("2 - По полному пути");

                                string folderCreationMode;
                                bool validFolderMode = false;
                                do
                                {
                                    Console.Write("Ваш выбор: ");
                                    folderCreationMode = Console.ReadLine();
                                    if (folderCreationMode == "1" || folderCreationMode == "2")
                                        validFolderMode = true;
                                    else
                                        Console.WriteLine("Несуществующий выбор, попробуйте снова");
                                } while (!validFolderMode);

                                string directoryPath;

                                if (folderCreationMode == "1")
                                {
                                    Console.Write("Введите имя новой папки: ");
                                    string newFolderName;
                                    do
                                    {
                                        newFolderName = Console.ReadLine();
                                    } while (string.IsNullOrWhiteSpace(newFolderName));

                                    string projectRoot = Directory.GetParent(Directory.GetCurrentDirectory()).Parent.Parent.FullName;
                                    string projectDirectory = Path.Combine(projectRoot, "LAB_8.NET");
                                    directoryPath = Path.Combine(projectDirectory, newFolderName);
                                }
                                else
                                {
                                    Console.Write("Введите полный путь к новой папке: ");
                                    do
                                    {
                                        directoryPath = Console.ReadLine();
                                    } while (string.IsNullOrWhiteSpace(directoryPath));
                                    Console.WriteLine($"Папка будет создана: {directoryPath}");
                                }

                                try
                                {
                                    if (Directory.Exists(directoryPath))
                                    {
                                        Console.WriteLine($"Папка уже существует: {directoryPath}");
                                    }
                                    else
                                    {
                                        Directory.CreateDirectory(directoryPath);
                                        Console.WriteLine($"Папка успешно создана: {directoryPath}");
                                    }
                                }
                                catch (Exception ex)
                                {
                                    Console.WriteLine($"Ошибка при создании папки: {ex.Message}");
                                }
                            }
                            break;

                        case 3:
                            {
                                string projectRootPath = Directory.GetParent(Directory.GetCurrentDirectory()).Parent.Parent.FullName;
                                string projectDirectory = Path.Combine(projectRootPath, "LAB_8.NET");

                                Console.Write("Введите имя файла: ");
                                string textFileName;
                                do
                                {
                                    textFileName = Console.ReadLine();
                                } while (string.IsNullOrWhiteSpace(textFileName));

                                string textFilePath = Path.Combine(projectDirectory, textFileName);
                                Console.WriteLine($"Файл будет создан: {textFilePath}");

                                Console.WriteLine("\nВыберите метод создания файла:");
                                Console.WriteLine("1 - File.Create()");
                                Console.WriteLine("2 - File.WriteAllText()");
                                Console.WriteLine("3 - File.AppendAllText()");
                                Console.WriteLine("4 - FileStream");
                                Console.WriteLine("5 - StreamWriter");

                                int creationMethod;
                                bool validCreationMethod = false;
                                do
                                {
                                    Console.Write("Ваш выбор: ");
                                    if (int.TryParse(Console.ReadLine(), out creationMethod) && creationMethod >= 1 && creationMethod <= 5)
                                        validCreationMethod = true;
                                    else
                                        Console.WriteLine("Несуществующий выбор, попробуйте снова");
                                } while (!validCreationMethod);

                                try
                                {
                                    switch (creationMethod)
                                    {
                                        case 1:
                                            using (File.Create(textFilePath)) { }
                                            Console.WriteLine("Файл создан методом File.Create()");
                                            break;

                                        case 2:
                                            File.WriteAllText(textFilePath, "Текст записан методом File.WriteAllText()\nДата создания: " + DateTime.Now);
                                            Console.WriteLine("Файл создан и заполнен методом File.WriteAllText()");
                                            break;

                                        case 3:
                                            File.AppendAllText(textFilePath, "Текст дописан методом File.AppendAllText()\nДата: " + DateTime.Now + "\n");
                                            Console.WriteLine("Файл создан/дополнен методом File.AppendAllText()");
                                            break;

                                        case 4:
                                            using (FileStream fileStream = new FileStream(textFilePath, FileMode.Create, FileAccess.Write))
                                            {
                                                byte[] textData = Encoding.UTF8.GetBytes("Текст записан через FileStream\nДата: " + DateTime.Now);
                                                fileStream.Write(textData, 0, textData.Length);
                                            }
                                            Console.WriteLine("Файл создан методом FileStream");
                                            break;

                                        case 5:
                                            using (StreamWriter textWriter = new StreamWriter(textFilePath))
                                            {
                                                textWriter.WriteLine("Текст записан через StreamWriter");
                                                textWriter.WriteLine("Дата создания: " + DateTime.Now);
                                            }
                                            Console.WriteLine("Файл создан методом StreamWriter");
                                            break;
                                    }

                                    Console.WriteLine($"Файл находится по пути: {textFilePath}");
                                }
                                catch (Exception ex)
                                {
                                    Console.WriteLine($"Ошибка при создании файла: {ex.Message}");
                                }
                            }
                            break;

                        case 4:
                            {
                                string projectRootPath = Directory.GetParent(Directory.GetCurrentDirectory()).Parent.Parent.FullName;
                                string projectFolder = Path.Combine(projectRootPath, "LAB_8.NET");

                                Console.Write("Введите имя файла для чтения: ");
                                string readFileName;
                                do
                                {
                                    readFileName = Console.ReadLine();
                                } while (string.IsNullOrWhiteSpace(readFileName));

                                string readFilePath = Path.Combine(projectFolder, readFileName);
                                Console.WriteLine($"Файл для чтения: {readFilePath}");

                                if (!File.Exists(readFilePath))
                                {
                                    Console.WriteLine("Файл не найден: " + readFilePath);
                                    break;
                                }

                                Console.WriteLine("\nВыберите метод чтения:");
                                Console.WriteLine("1 - File.ReadAllText()");
                                Console.WriteLine("2 - File.ReadAllLines()");
                                Console.WriteLine("3 - FileStream + StreamReader");
                                Console.WriteLine("4 - StreamReader напрямую");

                                int readMethod;
                                bool validReadMethod = false;
                                do
                                {
                                    Console.Write("Ваш выбор: ");
                                    if (int.TryParse(Console.ReadLine(), out readMethod) && readMethod >= 1 && readMethod <= 4)
                                        validReadMethod = true;
                                    else
                                        Console.WriteLine("Несуществующий выбор, попробуйте снова");
                                } while (!validReadMethod);

                                try
                                {
                                    Console.WriteLine("\nСодержимое файла: \n");

                                    switch (readMethod)
                                    {
                                        case 1:
                                            string fullText = File.ReadAllText(readFilePath);
                                            Console.WriteLine(fullText);
                                            break;

                                        case 2:
                                            string[] textLines = File.ReadAllLines(readFilePath);
                                            foreach (string line in textLines)
                                                Console.WriteLine(line);
                                            break;

                                        case 3:
                                            using (FileStream readStream = new FileStream(readFilePath, FileMode.Open, FileAccess.Read))
                                            using (StreamReader streamReader = new StreamReader(readStream, Encoding.UTF8))
                                            {
                                                Console.WriteLine(streamReader.ReadToEnd());
                                            }
                                            break;

                                        case 4:
                                            using (StreamReader directReader = new StreamReader(readFilePath, Encoding.UTF8))
                                            {
                                                string currentLine;
                                                while ((currentLine = directReader.ReadLine()) != null)
                                                    Console.WriteLine(currentLine);
                                            }
                                            break;
                                    }
                                }
                                catch (Exception ex)
                                {
                                    Console.WriteLine($"Ошибка при чтении файла: {ex.Message}");
                                }
                            }
                            break;

                        case 0:
                            Console.WriteLine("Выход из программы");
                            break;
                        default:
                            Console.WriteLine("Несуществующее действие, попробуйте снова");
                            break;
                    }
                } while (mainChoice != 0);
            }
            catch
            {
                Console.WriteLine("Ошибка. Введите целое число");
                goto startMenu;
            }
        }
    }
}
